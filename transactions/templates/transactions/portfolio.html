<!DOCTYPE html>
<html lang="fa" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>VFD Pro â€“ Portfolio</title>

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; font-family: "Segoe UI", sans-serif; }
        .navbar-vfd { background: linear-gradient(90deg, #0066cc, #0099ff); }
        .navbar-vfd .navbar-brand { font-weight: 700; letter-spacing: 0.04em; }
        .navbar-vfd .nav-link.active { font-weight: 600; border-bottom: 3px solid #ffffff; }
        .page-title { font-size: 1.4rem; font-weight: 600; margin-bottom: 1rem; }
        .tag-checkbox {
            display: inline-flex; align-items: center;
            border-radius: 999px; padding: 4px 12px;
            border: 1px solid #ced4da; background-color: #ffffff;
            margin: 4px; cursor: pointer; font-size: 0.85rem;
        }
        .tag-checkbox input { margin-right: 6px; }
        .tag-checkbox-active { background-color: #e6f3ff; border-color: #0d6efd; color: #0d6efd; }
        .filter-card { box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08); border-radius: 0.75rem; }
        .btn-apply { background-color: #28a745; border-color: #28a745; min-width: 110px; }
        .btn-reset { background-color: #0d6efd; border-color: #0d6efd; min-width: 110px; }
        .table-sticky-header thead th {
            position: sticky; top: 0; background-color: #0d6efd;
            color: #ffffff; z-index: 2; font-size: 0.8rem; vertical-align: middle;
        }
        .table-sticky-header { border-radius: 0.75rem; overflow: hidden; }
        .table tbody tr:nth-child(even) { background-color: #f8fafc; }
        .amount-cell { text-align: right; direction: ltr; white-space: nowrap; }
        .date-cell { direction: ltr; white-space: nowrap; }
        .section-title { font-size: 0.9rem; font-weight: 600; color: #6c757d; text-transform: uppercase; letter-spacing: 0.08em; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark navbar-vfd">
    <div class="container-fluid px-4">
        <a class="navbar-brand" href="#">VFD Pro</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarVfd" aria-controls="navbarVfd"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarVfd">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Reports</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main class="container-fluid px-4 py-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="page-title">Portfolio</div>
    </div>

    <form method="get">
        <div class="row g-3 mb-4">

            <!-- Filters -->
            <div class="col-lg-5">
                <div class="card filter-card">
                    <div class="card-body">
                        <span class="section-title">Filters</span>

                        <div class="mb-3 mt-3">
                            <input type="text"
                                   name="search"
                                   class="form-control"
                                   placeholder="Search (description, source, category)..."
                                   value="{{ search }}">
                        </div>

                        <div class="mb-3">
                            <div class="mb-1 small text-muted">Source</div>
                            <div>
                                {% for s in available_sources %}
                                    {% if s %}
                                        <label class="tag-checkbox {% if s in selected_sources %}tag-checkbox-active{% endif %}">
                                            <input type="checkbox"
                                                   name="source"
                                                   value="{{ s }}"
                                                   {% if s in selected_sources %}checked{% endif %}>
                                            {{ s }}
                                        </label>
                                    {% endif %}
                                {% empty %}
                                    <span class="text-muted small">No sources</span>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="mb-1 small text-muted">Category</div>
                            <div>
                                {% for c in available_categories %}
                                    {% if c %}
                                        <label class="tag-checkbox {% if c in selected_categories %}tag-checkbox-active{% endif %}">
                                            <input type="checkbox"
                                                   name="category"
                                                   value="{{ c }}"
                                                   {% if c in selected_categories %}checked{% endif %}>
                                            {{ c }}
                                        </label>
                                    {% endif %}
                                {% empty %}
                                    <span class="text-muted small">No categories</span>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="mb-1 small text-muted">Currency</div>
                            <div>
                                {% for cur in available_currencies %}
                                    {% if cur %}
                                        <label class="tag-checkbox {% if cur in selected_currencies %}tag-checkbox-active{% endif %}">
                                            <input type="checkbox"
                                                   name="currency_code"
                                                   value="{{ cur }}"
                                                   {% if cur in selected_currencies %}checked{% endif %}>
                                            {{ cur }}
                                        </label>
                                    {% endif %}
                                {% empty %}
                                    <span class="text-muted small">No currencies</span>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="d-flex gap-2 mt-3">
                            <button type="submit" class="btn btn-apply">Apply</button>
                            <a href="{% url 'portfolio' %}" class="btn btn-reset">Reset</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Year / Month -->
            <div class="col-lg-4">
                <div class="card filter-card h-100">
                    <div class="card-body">
                        <div class="section-title mb-2">Key Numbers</div>

                        <div class="mb-3">
                            <label class="form-label small">Year</label>
                            <select class="form-select" name="year">
                                <option value="">All years</option>
                                {% for y in years %}
                                    <option value="{{ y }}"{% if selected_year == y|stringformat:"s" %} selected{% endif %}>
                                        {{ y }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small">Month</label>
                            <select class="form-select" name="month">
                                <option value="">All months</option>
                                {% for m_val, m_name in months %}
                                    <option value="{{ m_val }}"{% if selected_month == m_val|stringformat:"s" %} selected{% endif %}>
                                        {{ m_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-apply flex-grow-1">Apply</button>
                            <a href="{% url 'portfolio' %}" class="btn btn-reset flex-grow-1">Reset</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slider dummy -->
            <div class="col-lg-3">
                <div class="card filter-card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="section-title mb-2">Improve Key Numbers</div>
                        <label for="improveRange" class="form-label small mb-1">Scenario (no backend yet)</label>
                        <input type="range" class="form-range" id="improveRange" min="0" max="100" value="0">
                        <div class="text-end small text-muted">
                            <span id="improveValue">0</span>%
                        </div>
                        <div class="mt-auto d-flex gap-2">
                            <button type="button" class="btn btn-apply flex-grow-1"
                                    onclick="document.getElementById('improveRange').value = 0; document.getElementById('improveValue').innerText = 0;">
                                Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </form>

    <!-- GRID -->
    <div class="card mt-3">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span class="section-title mb-0">Current Transactions (Top 10)</span>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive table-sticky-header" style="max-height: 480px;">
                <table class="table table-sm mb-0">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Client ID</th>
                        <th>Account ID</th>
                        <th>Source</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Currency</th>
                        <th>Rate</th>
                        <th>Net Amount</th>
                        <th>Gross Amount</th>
                        <th>Tax Amount</th>
                        <th>Transaction Date</th>
                        <th>Issued Date</th>
                        <th>Created Datetime</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for t in transactions %}
                        <tr>
                            <td>{{ t.id }}</td>
                            <td>{{ t.client_id }}</td>
                            <td>{{ t.account_id }}</td>
                            <td>{{ t.source }}</td>
                            <td>{{ t.category }}</td>
                            <td class="text-truncate" style="max-width: 240px;">{{ t.description }}</td>
                            <td>{{ t.currency_code }}</td>
                            <td class="amount-cell">{{ t.currency_rate }}</td>
                            <td class="amount-cell">{{ t.net_amount }}</td>
                            <td class="amount-cell">{{ t.gross_amount }}</td>
                            <td class="amount-cell">{{ t.tax_amount }}</td>
                            <td class="date-cell">{{ t.transaction_date }}</td>
                            <td class="date-cell">{{ t.issued_date }}</td>
                            <td class="date-cell">{{ t.created_datetime }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="14" class="text-center text-muted py-4">
                                No transactions found.
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const rangeEl = document.getElementById('improveRange');
    const valueEl = document.getElementById('improveValue');
    if (rangeEl && valueEl) {
        rangeEl.addEventListener('input', function () {
            valueEl.innerText = this.value;
        });
    }
</script>
</body>
</html>
